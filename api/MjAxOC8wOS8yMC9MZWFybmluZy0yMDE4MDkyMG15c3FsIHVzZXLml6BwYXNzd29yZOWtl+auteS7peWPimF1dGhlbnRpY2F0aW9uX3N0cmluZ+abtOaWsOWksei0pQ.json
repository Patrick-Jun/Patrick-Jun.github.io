{"title":"mysql user无password字段以及authentication_string更新失败","date":"2018-09-20T07:47:09.000Z","date_formatted":{"ll":"Sep 20, 2018","L":"09/20/2018","MM-DD":"09-20"},"link":"2018/09/20/Learning-20180920mysql user无password字段以及authentication_string更新失败","comments":true,"tags":["Mysql"],"categories":["Learning"],"updated":"2021-02-18T03:42:13.045Z","content":"<p><img src=\"http://blog.wujun.sc.cn/wp-content/uploads/2018/09/1_6bR8EymfDrVLb408TUNk-g.jpeg\" alt=\"\" class=\"φbs\"></p>\n<p>mysql传统改密码方式发现没有 password这个字段?</p>\n<p>网上查了一下据说5.7 版本password 字段改成authentication_string password函数还是原来的password函数; 我们可以查看一下当前user结构：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; desc user; </span><br></pre></td></tr></table></figure>\n<p>发现确实没有password字段，只有authentication_string；</p>\n<p>然后尝试：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; update user <span class=\"built_in\">set</span> authentication_string=password(<span class=\"string\">&#x27;123&#x27;</span>) <span class=\"built_in\">where</span> user=<span class=\"string\">&#x27;root&#x27;</span>; </span><br><span class=\"line\">ERROR 1175 (HY000): You are using safe update mode and you tried to update a table without a WHERE that uses a KEY column</span><br></pre></td></tr></table></figure>\n<p>竟然有不能修改，最后又得知原因是：mysql有个叫SQL_SAFE_UPDATES的变量，为了数据库更新操作的安全性，此值默认为1，所以才会出现更新失败的情况。</p>\n<p>查看设置：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; show variables like <span class=\"string\">&#x27;sql_safe%&#x27;</span>; </span><br><span class=\"line\">+------------------+-------+ </span><br><span class=\"line\">| Variable_name | Value | </span><br><span class=\"line\">+------------------+-------+ </span><br><span class=\"line\">| sql_safe_updates | ON | </span><br><span class=\"line\">+------------------+-------+ </span><br><span class=\"line\">1 row <span class=\"keyword\">in</span> <span class=\"built_in\">set</span> (0.00 sec) </span><br></pre></td></tr></table></figure>\n<p>下面是SQL_SAFE_UPDATES变量为0和1时的取值说明：</p>\n<p>SQL_SAFE_UPDATES有两个取值0和1， 或ON 和OFF;<br>\nSQL_SAFE_UPDATES = 1，ON时，不带where和limit条件的update和delete操作语句是无法执行的，即使是有where和limit条件但不带key column的update和delete也不能执行。<br>\nSQL_SAFE_UPDATES =0，OFF时，update和delete操作将会顺利执行。那么很显然，此变量的默认值是1。<br>\n所以，出现1175错误的时候，可以先设置SQL_SAFE_UPDATES的值为0 OFF，然后再执行更新;<br>\n执行以下命令：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; <span class=\"built_in\">set</span> sql_safe_updates=off; </span><br><span class=\"line\">Query OK, 0 rows affected (0.00 sec) </span><br></pre></td></tr></table></figure>\n<p>再次修改密码：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; update user <span class=\"built_in\">set</span> authentication_string=password(<span class=\"string\">&#x27;123&#x27;</span>) <span class=\"built_in\">where</span> user=<span class=\"string\">&#x27;root&#x27;</span>; </span><br><span class=\"line\">Query OK, 1 row affected, 1 warning (0.00 sec) </span><br></pre></td></tr></table></figure>\n<p>最后再刷新一下权限：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; FLUSH PRIVILEGES; </span><br><span class=\"line\">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>","prev":{"title":"生活","link":"2018/11/28/Life-Life"},"next":{"title":"阿里轻量云服务器ssl证书部署","link":"2018/09/18/Learning-20180918阿里轻量云服务器ssl证书部署"},"plink":"https://www.zzboy.cn/2018/09/20/Learning-20180920mysql user无password字段以及authentication_string更新失败/","reward":true,"copyright":{"author":"Patrick Jun","link":"<a href=\"https://www.zzboy.cn/2018/09/20/Learning-20180920mysql user无password字段以及authentication_string更新失败/\" title=\"mysql user无password字段以及authentication_string更新失败\">https://www.zzboy.cn/2018/09/20/Learning-20180920mysql user无password字段以及authentication_string更新失败/</a>","license":"自由转载-非商用-禁止演绎-保持署名 (<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","published":"September 20, 2018"}}